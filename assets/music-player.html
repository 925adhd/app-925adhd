<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>925 ADHD | Music Player</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:8px;background:#0f1724;color:#fff}
    #container{display:flex;gap:8px;align-items:center}
    #trackTitle{flex:1;font-size:13px;font-weight:600}
    audio{width:100%}
    iframe{border:0;width:100%;height:80px}
  </style>
</head>
<body>
  <div id="container">
    <div id="trackTitle">No track</div>
  </div>
  <div id="media">
    <audio id="player" controls style="width:100%;display:none"></audio>
    <iframe id="sc" style="display:none" allow="autoplay; encrypted-media"></iframe>
  </div>

  <script>
    function setAudio(src, title){
      const p = document.getElementById('player');
      const sc = document.getElementById('sc');
      sc.style.display = 'none';
      p.style.display = 'block';
      p.src = src;
      p.play().catch(()=>{});
      document.getElementById('trackTitle').textContent = title || '';
    }

    function setSoundCloud(embedUrl, title){
      const p = document.getElementById('player');
      const sc = document.getElementById('sc');
      p.pause();
      p.style.display = 'none';
      sc.style.display = 'block';
      sc.src = embedUrl;
      document.getElementById('trackTitle').textContent = title || 'SoundCloud';
    }

    window.addEventListener('message', (e)=>{
      const d = e.data || {};
      if(d.type === 'play'){
        if(d.provider === 'audio' && d.src) setAudio(d.src, d.title);
        else if(d.provider === 'soundcloud' && d.embed) setSoundCloud(d.embed, d.title);
        try{ localStorage.setItem('persistent_music', JSON.stringify(d)); }catch(e){}
      }
    });

    // Restore last track if present
    try{
      const saved = localStorage.getItem('persistent_music');
      if(saved){
        const d = JSON.parse(saved);
        if(d.provider === 'audio' && d.src) setAudio(d.src, d.title);
        else if(d.provider === 'soundcloud' && d.embed) setSoundCloud(d.embed, d.title);
      }
    }catch(e){}
  </script>
</body>
</html>
